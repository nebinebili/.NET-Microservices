
cd C:\Users\Admin\source\repos\.NET-Microservices\PlatformService
docker-compose down
docker-compose up --build

kubectl exec -it <pod-name> -- ls /app

kubectl logs platforms-depl-bcd89dc7b-dd5dz -c platformservice

kubectl describe svc <service-name>

minikube service my-service --url

docker exec -it ad86939f0c53 sh
docker logs ad86939f0c53

curl http://localhost:8080/api/Platform/

 C:\Users\Admin\Source\Repos\.NET-Microservices

---------- Docker islemese bunu ele--------------------------

bu iki command powershellde isledin dockernan bagli seyleri bagliyirsan:
Get-Service | Where-Object { $_.Name -like "*docker*" } | Stop-Service -Force
wsl --unregister docker-desktop
bunnan da yoxluyursan baglanib ya yox:
wsl -l -v

--------------------------------------------------------------------------------------Docker---------------------------------------------------------------------------------------------
1ï¸âƒ£ Docker Image â†’ TÉ™tbiqin bÃ¼tÃ¼n asÄ±lÄ±lÄ±qlarÄ± ilÉ™ birlikdÉ™ saxlanÄ±lan hazÄ±r ÅŸablon.
2ï¸âƒ£ Docker Container â†’ Docker image-dÉ™n yaradÄ±lan vÉ™ real vaxtda iÅŸlÉ™yÉ™n tÉ™tbiq mÃ¼hiti.
3ï¸âƒ£ Dockerfile â†’ Docker image yaratmaq Ã¼Ã§Ã¼n istifadÉ™ olunan skript faylÄ±.
4ï¸âƒ£ Docker Hub â†’ HazÄ±r image-lÉ™rin saxlanÄ±ldÄ±ÄŸÄ± mÉ™rkÉ™zi repozitoriya.

imageler bir nov setup rolu oynuyur,proqramin ozunu qaldirdiqda container sayilir.Meselen biz terminalda: docker pull ubuntu yazdiqda image yuklenir.
docker run ubuntu yazdiqda ise ubuntu container ise dusur.


Terminalda yazib yoxluya bilersen:
1.docker pull mongo-mongo imagesi docker-a yukluyur
2.docker images-imagesleri gosterir
3.docker run mongo-mongo container ise dusur
4.docker ps-ayaqda olan conatinerleri gosterir
5.docker ps -a-kecmis conatinerleri gosterir
6.docker run -it --name bash_ubuntu ubuntu- bu command ile conatinere ad verirsen --name(ad)
7.docker start bash_ubuntu- burda bash_ubuntu container start olur
8.docker stop bash_ubuntu- burda bash_ubuntu container stop olur,id ilede stop elemek olar.
9.docker rm id- conatineri id ve ya ad da yazib sile bilersiz
10.docker container rm $(docker container ls -aq)-butun containerleri silir
11,docker run -d mongo-detach mode ile arxa planda isleyir
12.docker inspect id ve ya name-container ve ya imagein melumatlarini gosterir


----------------Praktika hissesi yeni kod hissesi-------------------

1.docker build -t myapp .--->image yaratmaq ucun eger bu islemerse asagidaki command komek edecek.
2.docker build -t nabili/platformservice -f ./PlatformService/Dockerfile .---->burada birbasa dockerfilein yerini gostererek emeliyyati yerine yetiririk.
3.docker run -p 8080:80 -d nabili/platformservice ----> bu command container i 8080 portunda ise salir(her defe isletdikde yenisi yaranir)
4.docker push -------> komandasÄ± Docker image Docker Hub vÉ™ ya digÉ™r registry-lÉ™rÉ™ yÃ¼klÉ™mÉ™k Ã¼Ã§Ã¼n istifadÉ™ olunur.Bu É™mrlÉ™ image paylaÅŸa bilÉ™r, baÅŸqalarÄ±na istifadÉ™ etmÉ™yÉ™ imkan verÉ™ bilÉ™rsiniz.

-----------------------------------------------------------------------------Kubernetes--------------------------------------------------------------------------------------------------

Kubernetes (qÄ±saca K8s), Docker vÉ™ digÉ™r konteynerlÉ™ri avtomatik idarÉ™ edÉ™n aÃ§Ä±q mÉ™nbÉ™ (open-source) orkestrasiya sistemidir.

Bir cÃ¼mlÉ™ ilÉ™: Kubernetes, bir Ã§ox konteyneri avtomatik idarÉ™ edÉ™n, miqyaslandÄ±ran vÉ™ yerlÉ™ÅŸdirÉ™n bir sistemdir.

ğŸ”¹ Docker konteynerlÉ™rini idarÉ™ etmÉ™k Ã¼Ã§Ã¼n istifadÉ™ olunur.
ğŸ”¹ Avtomatik miqyaslandÄ±rma, yÃ¼k balanslama vÉ™ sÉ™hvlÉ™ri bÉ™rpa etmÉ™ kimi funksiyalarÄ± var.
ğŸ”¹ Mikroservis memarlÄ±ÄŸÄ±nda geniÅŸ istifadÉ™ olunur.

----------------Praktika hissesi yeni kod hissesi-------------------

app de kubernet aktiv etme ucun deploymentin konfiqurasiyalari oldugu yaml file yazilir sonra terminalda bu kod ise salinir(platforms-depl.yaml hemin yaml faylin adidi):
1.kubectl apply -f platforms-depl.yaml--->Bu ise salindiqda kubernetde pod yaranir
2.kubectl get deployment--->Kubernetes klasterinizdÉ™ki Deployment resurslarÄ±nÄ± gÃ¶stÉ™rir
3.kubectl get pods--->Kubernetes klasterindÉ™ Ã§alÄ±ÅŸan bÃ¼tÃ¼n Pod-larÄ±n siyahÄ±sÄ±nÄ± gÃ¶stÉ™rir.
4.kubectl delete deployments platforms-depl--->Deployment silmek ucundur

Hal hazirda Apideki melumatlar el catan deyil bunun ucun Service yaml yazilir:

apiVersion: v1
kind: Service
metadata:
  name: platformnpservice-srv
spec:
  type: NodePort
  selector:
    app: platformservice 
  ports:
    - name: platformservice
      protocol: TCP
      port: 80
      targetPort: 80
5.kubectl apply -f platforms-np-srv.yaml-->bunu apply edirsen
6.kubectl get services-->bunun vasitesi ile service melumatlari cixir ve baxib portunu goturub postmanda urlde yazib ise salirsan

Bu bir defe yazilir ve qalici olur.Demeli ilk defe service.yaml faylini elave etdikde bir pod yarandi ve meni maraqlandiran bu olduki deployment yaml elave etdikde pod yaranirdi 
amma maelumatalara cata bilmirdim indi bu service.yaml elave etdikde pod yarandi ve men bunun uzerinden melumatlara catdim.Fikirlesdim ki men portu birbasa deployment.yaml de qeyd edim 
ve ordan birbasa yaranan podnan isimi gorum ve melumatlarada catim.Arasdirdim ve gordum ki deployment.yaml faylin icinde port yazsan ne olur:
Pod-un iÃ§indÉ™ port aÃ§Ä±lÄ±r, amma bu porta yalnÄ±z klaster iÃ§indÉ™ki digÉ™r pod-lar Ã§ata bilÉ™r.Xarici mÃ¼ÅŸtÉ™rilÉ™r (Postman, browser vÉ™ s.) bu porta Ã§ata bilmir.
ğŸ’¡ Buna gÃ¶rÉ™ dÉ™ Service yaratmaq lazÄ±mdÄ±r.
Service olmadan pod-a birbaÅŸa qoÅŸulmaq mÃ¼mkÃ¼n deyil.

Sonda ise arasdirib onuda oyrendim ki ilk defe service.yaml add etdikde yaranan podu service.yaml yaratmiyib.O yarada bilmez men kubectl get pods,kubectl get deployments 
yoxlayib gormusdum ki bosdu amma sistemde bu bir defe yaranib silindiyne gore sistemde qalib hardasa.
ğŸš€Netice:YÉ™ni Service apply edÉ™ndÉ™ podun birdÉ™n yaranmasÄ±nÄ±n É™sl sÉ™bÉ™bi Deployment-in sistemdÉ™ qalÄ±b pod-u yenidÉ™n yaratmasÄ± olub!



---------------------------------------------------------------------Nginx-----------------------------------------------------------------------------------------


Nginx yÃ¼ksek performanslÄ± reverse proxy, load balancer vÉ™ web serverdir, É™sasÉ™n trafiki yÃ¶nlÉ™ndirmÉ™k, yÃ¼kÃ¼ bÃ¶lÃ¼ÅŸdÃ¼rmÉ™k vÉ™ tÉ™hlÃ¼kÉ™sizliyi artÄ±rmaq Ã¼Ã§Ã¼n istifadÉ™ olunur. Kubernetes-dÉ™ isÉ™ Ingress Controller kimi iÅŸlÉ™yÉ™rÉ™k xarici sorÄŸularÄ± daxili servislÉ™rÉ™ yÃ¶nlÉ™ndirir. 

âœ… ÆgÉ™r sadÉ™cÉ™ bir server Ã¼Ã§Ã¼n proxy vÉ™ load balancing lazÄ±mdÄ±rsa, adi Nginx istifadÉ™ edÉ™ bilÉ™rsÉ™n.
âœ… ÆgÉ™r Kubernetes-dÉ™ Ingress qaydalarÄ± ilÉ™ trafiki yÃ¶nlÉ™ndirmÉ™k istÉ™yirsÉ™nsÉ™, Ingress Nginx lazÄ±mdÄ±r.

YÉ™ni, Ingress Nginx = Kubernetes Ã¼Ã§Ã¼n optimallaÅŸdÄ±rÄ±lmÄ±ÅŸ Nginx versiyasÄ±dÄ±r. ğŸš€

XÃ¼susiyyÉ™t	                         Nginx	                                                    Ingress Nginx
Standalone iÅŸlÉ™yir?	       BÉ™li, Kubernetes olmadan iÅŸlÉ™yÉ™ bilÉ™r	                            Yox, Kubernetes klasterinÉ™ baÄŸlÄ±dÄ±r
Kubernetes dÉ™stÉ™yi	       Yoxdur, YAML vÉ™ Ingress qaydalarÄ±nÄ± anlamÄ±r	                    Kubernetes Ingress qaydalarÄ± ilÉ™ iÅŸlÉ™yir
Trafik yÃ¶nlÉ™ndirmÉ™	       Manual olaraq Nginx config faylÄ± ilÉ™ edilir	                    Ingress resurslarÄ±ndan avtomatik konfiqurasiya alÄ±r
Reverse Proxy &	               Var, amma É™l ilÉ™ konfiqurasiya lazÄ±mdÄ±r	                            Kubernetes servislÉ™ri Ã¼Ã§Ã¼n avtomatik edir
Load Balancing


-------Praktika hissesi ve kod hissesi----------------------

Ingress nginx app-e qurmaq ucun google da Ingress nginx qeyd etdikden sonra GitHub hesabi cixacaq ve start documentation edib ordan yuklemek mumkundur. 

Yazdigim appde ne etdim:
Compda olan host file tapdim ve icinde 127.0.0.1 acme.com yazdÄ±m ki, kompÃ¼terdÉ™ acme.com domeni localhost-a yÃ¶nlÉ™nsin.Fayl: C:\Windows\System32\drivers\etc\hosts
Daha sonra ingress-srv.yaml faylÄ±nda Ingress qaydalarÄ± yaratmÄ±sÄ±nÄ±z ki, gÉ™lÉ™n sorÄŸular Nginx tÉ™rÉ™findÉ™n dÃ¼zgÃ¼n xidmÉ™tlÉ™rÉ™ yÃ¶nlÉ™ndirilsin.
Filein ici:
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: ingress-srv
  annotations:
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/use-regex: 'true'
spec:
  rules:
    - host: acme.com
      http:
        paths:
          - path: /api/platform/GetAllPlatforms
            pathType: Prefix
            backend:
              service:
                name: platforms-clusterip-srv
                port:
                  number: 80
          - path: /api/c/platforms
            pathType: Prefix
            backend:
              service:
                name: commands-clusterip-srv
                port:
                  number: 80


Terminalda lazim olan commandlar nginx ucun:

1.kubectl get namespace
2.kubectl get pods --namespace=ingress-nginx
3.kubectl get services --namespace=ingress-nginx
4.kubectl apply -f ingress-srv.yaml
5.kubectl delete -f ingress-srv.yaml

Daha sonra neticeni yoxlamaq ucun Postmanda sorgu gonderilir acme.com domain ile birlikde:http://acme.com/api/platform/GetAllPlatforms

Belelikler melumatlara catmaq ucun Nodeport(Yuxarida qeyd etdiyimiz usul) ve Ingress Nginx istifade etdik.BUnlarin ferqine baxin ve qerari ozun ver:)


XÃ¼susiyyÉ™t	                                   NodePort	                                            Nginx Ingress
Xarici dÃ¼nyaya aÃ§Ä±lma	                      HÉ™r pod Ã¼Ã§Ã¼n bir port aÃ§Ä±r	                            TÉ™k bir giriÅŸ nÃ¶qtÉ™si (domain-based yÃ¶nlÉ™ndirmÉ™)
URL strukturu	                              http://localhost:30632/api/platforms (port lazÄ±mdÄ±r)	    http://acme.com/api/platforms (port yoxdur, sadÉ™dir)
Load Balancing	                              Yoxdur (yalnÄ±z bir node-a baÄŸlÄ±dÄ±r)	                    Var (Nginx Ã¶zÃ¼ yÃ¼kÃ¼ paylayÄ±r)
Security & SSL Support	                      Ã‡ox zÉ™ifdir, HTTPS Ã¼Ã§Ã¼n É™l ilÉ™ konfiqurasiya lazÄ±mdÄ±r	    SSL termination vÉ™ security imkanlarÄ± var
Routing (yÃ¶nlÉ™ndirmÉ™)	                      HÉ™r servisin Ã¶z portu var	                                    TÉ™k bir domain Ã¼zÉ™rindÉ™n fÉ™rqli servislÉ™rÉ™ keÃ§id mÃ¼mkÃ¼ndÃ¼r
Enterprise Use Case	                      KiÃ§ik test mÃ¼hitlÉ™ri Ã¼Ã§Ã¼n uyÄŸundur	                    BÃ¶yÃ¼k layihÉ™lÉ™rdÉ™ istifadÉ™ olunur

ğŸš€ ÆgÉ™r artÄ±q Nginx Ingress istifadÉ™ edirsÉ™nsÉ™, NodePort-a ehtiyac yoxdur!
ğŸ’¡ NodePort sadÉ™cÉ™ development vÉ™ test Ã¼Ã§Ã¼n istifadÉ™ edilÉ™ bilÉ™r, amma real sistemdÉ™ vÉ™ production-da Nginx daha gÃ¼clÃ¼ vÉ™ rahatdÄ±r.
YÉ™ni, sÉ™n artÄ±q Nginx Ingress istifadÉ™ edirsÉ™nsÉ™, bÃ¼tÃ¼n servislÉ™r Ã¼Ã§Ã¼n rahat vÉ™ tÉ™hlÃ¼kÉ™siz bir giriÅŸ nÃ¶qtÉ™n var, ona gÃ¶rÉ™ dÉ™ NodePort-a ehtiyac yoxdur. ğŸ˜Šâœ…


---------------------------------------Persistent Volume Claim----------------------------------
Kubernetes-dÉ™ podlar stateless (davamlÄ± mÉ™lumat saxlamayan) ÅŸÉ™kildÉ™ iÅŸlÉ™yir. YÉ™ni pod silindikdÉ™ vÉ™ ya restart olduqda onun daxili diskindÉ™ki mÉ™lumatlar silinir.
MSSQL kimi bir verilÉ™nlÉ™r bazasÄ±nda isÉ™ mÉ™lumatlarÄ±n itmÉ™si qÉ™buledilmÉ™zdir.

ğŸ”¹ Persistent Volume (PV) â€“ Fiziki vÉ™ ya bulud É™saslÄ± yaddaÅŸ sahÉ™sidir.
ğŸ”¹ Persistent Volume Claim (PVC) â€“ PodlarÄ±n bu yaddaÅŸa qoÅŸulmasÄ±nÄ± tÉ™min edÉ™n resursdur.

ğŸ’¡ QÄ±saca desÉ™k:

PVC, podun disk yaddaÅŸÄ± Ã¼Ã§Ã¼n rezervasiya etdiyi bir tÉ™lÉ™blikdir.

PVC olmadan pod hÉ™r restartda boÅŸ bir disk ilÉ™ baÅŸlayÄ±r vÉ™ É™vvÉ™lki mÉ™lumatlar itir.

PVC pod restart olsa belÉ™ mÉ™lumatlarÄ± qoruyur.

MSSQL Server Ã¶z database.mdf vÉ™ log.ldf fayllarÄ±nÄ± diskdÉ™ saxlayÄ±r.
ÆgÉ™r PVC istifadÉ™ olunmazsa, pod silindikdÉ™ vÉ™ ya restart olduqda:

BÃ¼tÃ¼n verilÉ™nlÉ™r bazasÄ± silinir.

MSSQL hÉ™r dÉ™fÉ™ yeni boÅŸ bir baza ilÉ™ baÅŸlayÄ±r.

MÉ™lumat itkisinin qarÅŸÄ±sÄ±nÄ± almaq olmur.

PVC sayÉ™sindÉ™: âœ… MSSQL Server-in mÉ™lumatlarÄ± qorunur.
âœ… Pod restart olsa belÉ™ mÉ™lumatlar qalÄ±r.
âœ… Kubernetes Stateful bir sistem kimi davranÄ±r.

ğŸ”¹ PVC, podun verilÉ™nlÉ™r bazasÄ±nÄ± restart vÉ™ ya pod silindikdÉ™ belÉ™ qoruyur.
ğŸ”¹ MÉ™lumatlarÄ± saxlamaq Ã¼Ã§Ã¼n disk resursu ayÄ±rÄ±r.
ğŸ”¹ PVC olmadan MSSQL hÉ™r restartda boÅŸ bir verilÉ™nlÉ™r bazasÄ± ilÉ™ baÅŸlayar.

âœ… ÆgÉ™r Kubernetes-dÉ™ MSSQL iÅŸlÉ™dirsÉ™nsÉ™, PVC istifadÉ™ etmÉ™yin mÃ¼tlÉ™qdir! ğŸš€

------------------------------------------Praktika Kod hissesi--------------------------------------------
local-pvc.yaml:
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mssql-claim
spec:
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 200Mi

bunu apply persistent volume claim yaranir

1.kubectl get pvc-pvc ya baxmaq ucun

MSSQL-in add edilmesi:

mssql-plat-depl.yaml:
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mssql-depl
spec:
  replicas: 1
  selector:
    matchLabels:
      app: mssql
  template:
    metadata:
      labels:
        app: mssql
    spec:
      containers:
        - name: mssql
          image: mcr.microsoft.com/mssql/server:2017-latest
          ports:
            - containerPort: 1433
          env:
          - name: MSSQL_PID
            value: "Express"
          - name: ACCEPT_EULA
            value: "Y"
          - name: SA_PASSWORD
            valueFrom:
              secretKeyRef:
                name: mssql
                key: SA_PASSWORD
          volumeMounts: 
          - mountPath: /var/opt/mssql/data
            name: mssqldb
      volumes: 
      - name: mssqldb
        persistentVolumeClaim:
          claimName: mssql-claim
---
apiVersion: v1
kind: Service
metadata:
  name: mssql-clusterip-srv
spec:
  type: ClusterIP
  selector:
    app: mssql
  ports:
  - name: mssql
    protocol: TCP
    port: 1433
    targetPort: 1433
---
apiVersion: v1
kind: Service
metadata:
  name: mssql-loadbalancer
spec:
  type: LoadBalancer
  selector:
    app: mssql
  ports: 
  - protocol: TCP
    port: 1433
    targetPort: 1433

2.kubectl create secret generic mssql --from-literal=SA_PASSWORD="besiktas1903"-bu secretKeyRef hissesidi
3.kubectl apply-f mssql-plat-depl.yaml-bu fayl elave edilir
4.dotnet ef migrations add initialmigration-migration yaradilir


----------------------------------------------------------- RabbitMQ--------------------------------------------------------------------------------
RabbitMQ, aÃ§Ä±q mÉ™nbÉ™li mesaj brokeridir. Mesaj brokerlÉ™ri, mÃ¼xtÉ™lif sistemlÉ™rin bir-biri ilÉ™ mÉ™lumatlarÄ±nÄ± mÃ¼badilÉ™ etmÉ™sinÉ™ kÃ¶mÉ™k edir. RabbitMQ, AMQP (Advanced Message Queuing Protocol)â€™un standartlaÅŸdÄ±rÄ±lmasÄ± ilÉ™ uyÄŸunlaÅŸÄ±r vÉ™ bu protokol vasitÉ™silÉ™ mÃ¼xtÉ™lif proqramlar vÉ™ platformalar arasÄ±nda asinxron mesajlaÅŸma imkanÄ± yaradÄ±r.

RabbitMQâ€™nun â€œPublisher-Exchange-Queue-Consumerâ€ modeli, mesajlarÄ±n necÉ™ daÅŸÄ±ndÄ±ÄŸÄ± vÉ™ iÅŸlÉ™diyi haqqÄ±nda anlayÄ±ÅŸlardÄ±r.

1. Publisher â€” MesajlarÄ± gÃ¶ndÉ™rÉ™n sistem vÉ™ ya servisdir. Publisher vasitÉ™si ilÉ™ mesajlar mÃ¼É™yyÉ™n Exchangeâ€™É™ yÃ¶nlÉ™ndirilir.

2. Exchange â€” MesajlarÄ± alÄ±r vÉ™ bunlarÄ± lazÄ±mi Queueâ€™lÉ™rÉ™ kateqoriyalara ayÄ±raraq yÃ¶nlÉ™ndirir. Bu kateqoriyalarÄ± da Exchange Type olaraq adlandÄ±rÄ±rÄ±q (AÅŸaÄŸÄ±da izahÄ± verilir)

3. Queue â€” MesajÄ±n mÃ¼vÉ™qqÉ™ti olaraq saxlandÄ±ÄŸÄ± depodur.

4. Consumer â€” MesajlarÄ± alan vÉ™ lazÄ±mi iÅŸlÉ™ri Ã¼zÉ™rindÉ™ tÉ™tbiq edÉ™n sistem vÉ™ ya servisdir.

MesajÄ±n Publisherâ€™dÉ™n RabbitMQâ€™yÉ™ gÃ¶ndÉ™rilmÉ™si vÉ™ RabbitMQâ€™dÉ™n Consumerâ€™É™ gÃ¶ndÉ™rilmÉ™si zamanÄ± Channel anlayÄ±ÅŸÄ±ndan istifadÉ™ olunur. Bir sÃ¶zlÉ™ Channel vasitÉ™si ilÉ™ RabbitMQâ€™lÉ™ É™laqÉ™ yaradaraq mesaj gÃ¶ndÉ™rib ala bilÉ™rik. HÉ™r Channel, bir Queue vÉ™ ya Exchange ilÉ™ É™laqÉ™lÉ™ndirilib mÃ¼É™yyÉ™n kanal Ã¼zÉ™rindÉ™n gÃ¶ndÉ™rilÉ™ bilÉ™r

//Exchange Types

Exchange Typeâ€™lÉ™rin nÉ™ olduÄŸunu aydÄ±nlaÅŸdÄ±rmaq Ã¼Ã§Ã¼n É™vvÉ™lcÉ™ Routing Keyâ€™in nÉ™ olduÄŸuna nÉ™zÉ™r salaq

Routing Key: MesajlarÄ± mÃ¼É™yyÉ™n Exchangeâ€™dÉ™n mÃ¼É™yyÉ™n Queueâ€™yÉ™ yÃ¶nlÉ™ndirmÉ™k Ã¼Ã§Ã¼n istifadÉ™ olunan bir parametrdir.

3 nÃ¶v Exchange Type vardÄ±r:

1. Direct Exchange â€” MesajlarÄ± Routing Keyâ€™É™ gÃ¶rÉ™ konkret Queueâ€™lÉ™rÉ™ yÃ¶nlÉ™ndirir. Consumer bu Queueâ€™yÉ™ gÃ¶rÉ™ iÅŸini gÃ¶rÃ¼r.

2. Fanout Exchange â€” BÃ¼tÃ¼n Queueâ€™lÉ™rÉ™ mesajlarÄ±n kopyalarÄ±nÄ± gÃ¶ndÉ™rir Routing Key istifadÉ™ olunanlarÄ± isÉ™ gÃ¶ndÉ™rmÉ™yib gÃ¶z ardÄ± edir. Bu nÃ¶v mesajlarÄ±n birdÉ™n Ã§ox alÄ±cÄ± tÉ™rÉ™findÉ™n alÄ±nacaÄŸÄ± tÉ™qdirdÉ™ istifadÉ™ edilir.

3. Topic Exchange: Burada verilÉ™n Routing Keyâ€™lÉ™rÉ™ uyÄŸun olaraq fÉ™rqli fÉ™rqli Queueâ€™lÉ™rÉ™ yazmaq olur. Routing Keyâ€™lÉ™r bir vÉ™ ya birdÉ™n Ã§ox â€œwildcardâ€ simvolu istifadÉ™ edib bir neÃ§É™ Queue yÉ™ yÃ¶nlÉ™ndirilÉ™ bilÉ™r. â€*â€ vÉ™ ya â€œ#â€ ilÉ™ hÉ™r hansÄ±sa qrupa vÉ™ ya bÃ¼tÃ¼n mesajlara Ã§atmaq olur. Bu nÃ¶v, mesajÄ± fÉ™rqli-fÉ™rqli kateqoriyalara ayÄ±rmaq lazÄ±m olduqda istifadÉ™ olunur.

------------------------------------------------Praktika Kod Hissesi -------------------------------------------------------------
rabbitmq-depl.yaml:

apiVersion: apps/v1
kind: Deployment
metadata:
  name: rabbitmq-depl
spec:
  replicas: 1
  selector:
    matchLabels:
      app: rabbitmq
  template:
    metadata:
      labels:
        app: rabbitmq
    spec:
      containers:
        - name: rabbitmq
          image: rabbitmq:3-management
          ports:
            - containerPort: 15672
              name: rbmq-mgmt-port
            - containerPort: 5672
              name: rbmq-msg-port

---
apiVersion: v1
kind: Service
metadata:
  name: rabbitmq-clusterip-srv
spec:
  type: ClusterIP
  selector:
    app: rabbitmq
  ports:
  - name: rbmq-mgmt-port
    protocol: TCP
    port: 15672
    targetPort: 15672
  - name: rbmq-msg-port
    protocol: TCP
    port: 5672
    targetPort: 5672

---
apiVersion: v1
kind: Service
metadata:
  name: rabbitmq-loadbalancer
spec:
  type: LoadBalancer
  selector:
    app: rabbitmq
  ports: 
  - name: rbmq-mgmt-port
    protocol: TCP
    port: 15672
    targetPort: 15672
  - name: rbmq-msg-port
    protocol: TCP
    port: 5672
    targetPort: 5672



---------------------------------------------------------------------------Event Processing --------------------------------------------------------------

Event nÉ™dir, nÉ™ Ã¼Ã§Ã¼n istifadÉ™ olunur?
SadÉ™ dillÉ™:
Event â€“ sistemdÉ™ baÅŸ verÉ™n bir hadisÉ™ni bildirmÉ™k Ã¼Ã§Ã¼n istifadÉ™ olunur.
MÉ™sÉ™lÉ™n: â€œYeni platforma yaradÄ±ldÄ±â€ â€“ bu bir event-dir.

Bir servis (mÉ™sÉ™lÉ™n PlatformService) deyir:

â€œMÉ™n yeni bir platforma yaratdÄ±m!â€
VÉ™ bunu event ÅŸÉ™klindÉ™ Platform_Published adÄ± ilÉ™ gÃ¶ndÉ™rir.

DigÉ™r servis (mÉ™sÉ™lÉ™n CommandService) isÉ™ bu event-i qulaq asÄ±r vÉ™ deyir:

â€œAha, yeni platforma yaradÄ±lÄ±b? MÉ™n dÉ™ bunu Ã¶z bazama É™lavÉ™ edim.â€

Bu kodun mÉ™qsÉ™di:

BaÅŸqa bir servisdÉ™n gÉ™lÉ™n event mesajlarÄ±nÄ± dinlÉ™mÉ™k (yÉ™ni sistemdÉ™ nÉ™sÉ™ baÅŸ verdiyini bilmÉ™k).

O mesajÄ±n tipini mÃ¼É™yyÉ™n etmÉ™k (mÉ™sÉ™lÉ™n: Platform_Published).

ÆgÉ™r tanÄ±nan bir eventdirsÉ™, ona uyÄŸun É™mÉ™liyyat gÃ¶rmÉ™k (mÉ™sÉ™lÉ™n: DB-yÉ™ platformanÄ± É™lavÉ™ etmÉ™k).


----------------------------------------------------------------------------GRPC-----------------------------------------------------------------------------------------
gRPC â€” "Google Remote Procedure Call" demÉ™kdir.
Google tÉ™rÉ™findÉ™n yaradÄ±lÄ±b vÉ™ mikroservislÉ™r arasÄ±nda sÃ¼rÉ™tli vÉ™ effektiv Ã¼nsiyyÉ™t Ã¼Ã§Ã¼n istifadÉ™ olunur.

YÉ™ni bir servis, baÅŸqa bir servisdÉ™ olan funksiyanÄ± sanki lokal funksiyadÄ±rmÄ±ÅŸ kimi Ã§aÄŸÄ±rÄ±r.

ğŸ¯gRPC-nin mÉ™qsÉ™di nÉ™dir?
ServislÉ™r arasÄ±nda yÃ¼ksÉ™k performanslÄ± É™laqÉ™ qurmaq

KiÃ§ik Ã¶lÃ§Ã¼lÃ¼ vÉ™ tez cavab verÉ™n mÉ™lumat mÃ¼badilÉ™si

Real-time Ã¼nsiyyÉ™t Ã¼Ã§Ã¼n daha uyÄŸun olmaq (bidirectional streaming vÉ™ s.)


âš™ï¸ Texniki É™saslar
MÉ™lumatlar Protocol Buffers (protobuf) formatÄ±nda gÃ¶ndÉ™rilir â†’ JSON-dan daha sÃ¼rÉ™tlidir vÉ™ daha az yer tutur.

HTTP/2 istifadÉ™ edir â†’ paralel baÄŸlantÄ±lar, daha az gecikmÉ™, daha Ã§ox sÃ¼rÉ™t.

DÉ™stÉ™klÉ™diyi dillÉ™r: C#, Java, Go, Python vÉ™ s.



ğŸ” DigÉ™r servis modellÉ™ri ilÉ™ fÉ™rqlÉ™ri

XÃ¼susiyyÉ™t	               gRPC	                        REST API / HTTP	                           RabbitMQ / Kafka (Message Queue)
ÃœnsiyyÉ™t tipi	           Sinxron / Stream	               Sinxron (request/response)	             Asinxron (mesaj É™saslÄ±)
MÉ™lumat formatÄ±	          Protobuf (binary, yÃ¼ngÃ¼l)	       JSON (text, daha aÄŸÄ±r)	                  Mesaj (istÉ™nilÉ™n format ola bilÉ™r)
SÃ¼rÉ™t	                    Ã‡ox yÃ¼ksÉ™k	                            Orta	                          YÃ¼ksÉ™k (amma gecikmÉ™li ola bilÉ™r)
Æsas istifadÉ™ sahÉ™si	Mikroservis-to-mikroservis	      Web API-lÉ™r, aÃ§Ä±q interfeyslÉ™r	            Asinxron iÅŸlÉ™r, data paylaÅŸÄ±mÄ±


gRPC - Sinxron/Stream
gRPC, hÉ™m sinxron, hÉ™m dÉ™ streaming Ã¼nsiyyÉ™tini dÉ™stÉ™klÉ™yÉ™n bir protokoldur. Bu xÃ¼susiyyÉ™tlÉ™r aÅŸaÄŸÄ±dakÄ± ÅŸÉ™kildÉ™ izah edilÉ™ bilÉ™r:

Sinxron (Blocking):

Bu halda, mÃ¼ÅŸtÉ™ri sorÄŸu gÃ¶ndÉ™rir vÉ™ cavabÄ± alana qÉ™dÉ™r nÃ¶vbÉ™ti É™mÉ™liyyata keÃ§mir. Bu, adÉ™tÉ™n sadÉ™ API Ã§aÄŸÄ±rÄ±ÅŸlarÄ± Ã¼Ã§Ã¼n istifadÉ™ olunur. MÉ™sÉ™lÉ™n, bir mÉ™lumat sorÄŸusunu gÃ¶ndÉ™rmÉ™k vÉ™ dÉ™rhal cavab almaq.

MÉ™sÉ™lÉ™n: MÃ¼ÅŸtÉ™ri serverÉ™ sorÄŸu gÃ¶ndÉ™rir vÉ™ nÉ™ticÉ™ni gÃ¶zlÉ™yir (bloklanÄ±r) â€” bu zaman mÃ¼ÅŸtÉ™ri baÅŸqa heÃ§ bir É™mÉ™liyyat yerinÉ™ yetirÉ™ bilmir.

Stream (Asinxron vÉ™ ya Sinxron Stream):

gRPC hÉ™mÃ§inin streaming Ã¼nsiyyÉ™tini dÉ™stÉ™klÉ™yir. Burada, mÃ¼ÅŸtÉ™ri vÉ™ server arasÄ±nda mÉ™lumatÄ±n ardÄ±cÄ±l ÅŸÉ™kildÉ™ Ã¶tÃ¼rÃ¼lmÉ™si baÅŸ verir. Bu, bÃ¶yÃ¼k verilÉ™nlÉ™rin vÉ™ ya uzun davam edÉ™n É™mÉ™liyyatlarÄ±n sÉ™mÉ™rÉ™li Ã¶tÃ¼rÃ¼lmÉ™si Ã¼Ã§Ã¼n istifadÉ™ olunur.

Streaming, mÃ¼ÅŸtÉ™ri vÉ™ server arasÄ±nda davamlÄ± vÉ™ asinxron mÉ™lumat Ã¶tÃ¼rÃ¼lmÉ™si imkanÄ± verir, yÉ™ni hÉ™r iki tÉ™rÉ™f bir-birinin cavablarÄ±nÄ± gÃ¶zlÉ™mÉ™dÉ™n paralel iÅŸlÉ™yÉ™ bilÉ™r.

Streaming, gRPC'nin bir Ã¼stÃ¼nlÃ¼yÃ¼dÃ¼r, Ã§Ã¼nki tÉ™k bir É™laqÉ™ Ã¼zÉ™rindÉ™n Ã§oxlu verilÉ™nlÉ™ri Ã¶tÃ¼rmÉ™k mÃ¼mkÃ¼ndÃ¼r. Bu xÃ¼susiyyÉ™t, mÉ™sÉ™lÉ™n, real-time tÉ™tbiqlÉ™rdÉ™, video vÉ™ ya audio axÄ±nlarÄ± kimi bÃ¶yÃ¼k verilÉ™nlÉ™rin gÃ¶ndÉ™rilmÉ™si Ã¼Ã§Ã¼n É™hÉ™miyyÉ™tlidir.

MÉ™sÉ™lÉ™n, gRPC istifadÉ™ edÉ™rÉ™k server vÉ™ mÃ¼ÅŸtÉ™ri arasÄ±nda bir neÃ§É™ fÉ™rqli ssenari ilÉ™ É™laqÉ™ qurula bilÉ™r:

Sinxron Ã§aÄŸÄ±rÄ±ÅŸ: MÃ¼ÅŸtÉ™ri sorÄŸu gÃ¶ndÉ™rir, server cavab verir vÉ™ mÃ¼ÅŸtÉ™ri cavabÄ± alana qÉ™dÉ™r gÃ¶zlÉ™yir.

Server Streaming: MÃ¼ÅŸtÉ™ri bir sorÄŸu gÃ¶ndÉ™rir vÉ™ server bu sorÄŸuya qarÅŸÄ±lÄ±q olaraq ardÄ±cÄ±l mÉ™lumat axÄ±nÄ±nÄ± (stream) gÃ¶ndÉ™rir.

Client Streaming: MÃ¼ÅŸtÉ™ri bir neÃ§É™ sorÄŸu gÃ¶ndÉ™rir vÉ™ server yalnÄ±z axÄ±n bitdikdÉ™n sonra cavab verir.

Bidirectional Streaming: MÃ¼ÅŸtÉ™ri vÉ™ server eyni vaxtda axÄ±n Ã¼zÉ™rindÉ™n mÉ™lumat gÃ¶ndÉ™rir vÉ™ alÄ±r.


gRPC nÉ™ zaman istifadÉ™ olunur?
Mikroservis arxitekturasÄ±nda servis-to-servis É™laqÉ™

Real-time sistemlÉ™r (mÉ™sÉ™lÉ™n, Ã§at tÉ™tbiqlÉ™ri)

Mobil vÉ™ IoT cihazlarla sÃ¼rÉ™tli É™laqÉ™

PerformansÄ±n kritik olduÄŸu sistemlÉ™r


-----------------------Praktika hissesi-----------------------------------------------------
Paketler:
1. Grpc.AspNetCore
Ä°stifadÉ™: Bu paket ASP.NET Core ilÉ™ gRPC xidmÉ™tlÉ™ri qurmaÄŸa imkan verir.

Funksiya: gRPC serverini yaratmaÄŸa vÉ™ onu ASP.NET Core tÉ™tbiqinÉ™ É™lavÉ™ etmÉ™yÉ™ kÃ¶mÉ™k edir. Grpc.AspNetCore ASP.NET Core ilÉ™ gRPC istifadÉ™ etmÉ™k Ã¼Ã§Ã¼n lazÄ±m olan server vÉ™ mÃ¼ÅŸtÉ™ri komponentlÉ™rini tÉ™min edir.

ÃœstÃ¼nlÃ¼k: ASP.NET Core ilÉ™ asanlÄ±qla gRPC xidmÉ™tlÉ™ri qurmaÄŸa imkan verir, yÉ™ni web tÉ™tbiqlÉ™rinizdÉ™ gRPC istifadÉ™ etmÉ™k Ã¼Ã§Ã¼n lazÄ±m olan hÉ™r ÅŸeyi tÉ™min edir.

2. Grpc.Tools
Ä°stifadÉ™: Bu paket Protobuf fayllarÄ±ndan (.proto) kodlarÄ± avtomatik yaratmaq Ã¼Ã§Ã¼n istifadÉ™ olunur.

Funksiya: .proto fayllarÄ±nÄ± istifadÉ™ edÉ™rÉ™k gRPC xidmÉ™tlÉ™ri Ã¼Ã§Ã¼n lazÄ±mi C# siniflÉ™rini yaratmaq Ã¼Ã§Ã¼n lazÄ±mlÄ± alÉ™tlÉ™ri tÉ™min edir. Bu, gRPC servislÉ™rinizi avtomatik olaraq C# dilindÉ™ istifadÉ™ oluna bilÉ™n siniflÉ™rÉ™ Ã§evirmÉ™yÉ™ imkan verir.

ÃœstÃ¼nlÃ¼k: .proto faylÄ±nÄ± yazdÄ±qdan sonra, bu paket vasitÉ™silÉ™ gRPC xidmÉ™tlÉ™rinin istifadÉ™ edilÉ™ bilÉ™n C# versiyalarÄ±nÄ± asanlÄ±qla yarada bilÉ™rsiniz.

3. Grpc.Net.Client
Ä°stifadÉ™: Bu paket gRPC mÃ¼ÅŸtÉ™ri tÉ™tbiqlÉ™ri Ã¼Ã§Ã¼n istifadÉ™ olunur.

Funksiya: ServerÉ™ sorÄŸular gÃ¶ndÉ™rmÉ™k vÉ™ serverdÉ™n cavablar almaq Ã¼Ã§Ã¼n lazÄ±mlÄ± alÉ™tlÉ™ri tÉ™min edir. gRPC serverinÉ™ qoÅŸulmaq vÉ™ gRPC É™mÉ™liyyatlarÄ± hÉ™yata keÃ§irmÉ™k Ã¼Ã§Ã¼n bu paket istifadÉ™ olunur.

ÃœstÃ¼nlÃ¼k: ServerÉ™ gRPC sorÄŸularÄ± gÃ¶ndÉ™rmÉ™k Ã¼Ã§Ã¼n lazÄ±mlÄ± olan alÉ™tlÉ™ri tÉ™min edir. ÆsasÉ™n, gRPC mÃ¼ÅŸtÉ™risi yaratmaq Ã¼Ã§Ã¼n istifadÉ™ olunur.

4. Google.Protobuf
Ä°stifadÉ™: Bu paket Protobuf (Protocol Buffers) verilÉ™n formatÄ±nÄ± istifadÉ™ etmÉ™k Ã¼Ã§Ã¼n lazÄ±mlÄ±dÄ±r.

Funksiya: VerilÉ™nlÉ™rin marÅŸrutlaÅŸdÄ±rÄ±lmasÄ±nda vÉ™ Ã¶tÃ¼rÃ¼lmÉ™sindÉ™ istifadÉ™ olunan Protobuf formatÄ±nÄ± serializasiya vÉ™ deserializasiya etmÉ™k Ã¼Ã§Ã¼n alÉ™tlÉ™ri tÉ™min edir. GRPC, Protobuf formatÄ±nda mÉ™lumat Ã¶tÃ¼rÃ¼r, bu paket isÉ™ bu mÉ™lumatlarÄ± doÄŸru ÅŸÉ™kildÉ™ oxumaq vÉ™ yazmaq Ã¼Ã§Ã¼n lazÄ±mlÄ±dÄ±r.

ÃœstÃ¼nlÃ¼k: Protobuf mÉ™lumatlarÄ±nÄ± iÅŸlÉ™mÉ™k vÉ™ serializasiya/deserializasiya etmÉ™k Ã¼Ã§Ã¼n bu paket zÉ™ruridir.

QÄ±sa XÃ¼lasÉ™:
Grpc.AspNetCore: gRPC serverini ASP.NET Core ilÉ™ inteqrasiya edir.

Grpc.Tools: .proto fayllarÄ±nÄ± C# kodlarÄ±na Ã§evirir.

Grpc.Net.Client: gRPC mÃ¼ÅŸtÉ™ri tÉ™tbiqi Ã¼Ã§Ã¼n istifadÉ™ olunur.

Google.Protobuf: Protobuf verilÉ™n formatÄ±nÄ± iÅŸlÉ™mÉ™yÉ™ imkan verir.




Bu, .csproj (C# project file) faylÄ±nda Protobuf faylÄ±nÄ± É™lavÉ™ etmÉ™k Ã¼Ã§Ã¼n istifadÉ™ olunan bir ItemGroup konfiqurasiyasÄ±dÄ±r
<ItemGroup>
	<Protobuf Include="Protos\platforms.proto" GrpcServices="Server" />
</ItemGroup>
Bu konfiqurasiya ilÉ™ platforms.proto Protobuf faylÄ±nÄ± C# layihÉ™sinÉ™ É™lavÉ™ edirsiniz vÉ™ onu gRPC serveri Ã¼Ã§Ã¼n istifadÉ™ edirsiniz. Bu fayldan GrpcPlatform xidmÉ™tini yaratmaq vÉ™ mÃ¼vafiq C# siniflÉ™ri ilÉ™ server tÉ™rÉ™fini inkiÅŸaf etdirmÉ™k mÃ¼mkÃ¼n olacaq.
